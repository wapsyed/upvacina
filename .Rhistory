read_xl_sipni("SIPNI_cobertura_UF_1994.xlsx")
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
clean_names() %>%
mutate(cobertura = round(cobertura, 2))
return(dados_tidy)
}
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
clean_names() %>%
mutate(cobertura = round(cobertura, 2))
return(dados)
}
read_xl_sipni("SIPNI_cobertura_UF_1994.xlsx")
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
clean_names() %>%
mutate(cobertura = round(cobertura, 2)) %>%
filter(unidade_da_federacao != "NA")
return(dados)
}
read_xl_sipni("SIPNI_cobertura_UF_1994.xlsx")
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
clean_names() %>%
mutate(cobertura = round(cobertura, 2)) %>%
filter(.[[,1]] != "NA",
!grepl("Gerado", .[[,1]]))
return(dados)
}
read_xl_sipni("SIPNI_cobertura_UF_1994.xlsx")
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
clean_names() %>%
mutate(cobertura = round(cobertura, 2)) %>%
filter(is.na(.[,1]),
!grepl("Gerado", .[,1]))
return(dados)
}
read_xl_sipni("SIPNI_cobertura_UF_1994.xlsx")
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
clean_names() %>%
mutate(cobertura = round(cobertura, 2)) %>%
filter(!is.na(.[,1]),
!grepl("Gerado", .[,1]))
return(dados)
}
read_xl_sipni("SIPNI_cobertura_UF_1994.xlsx")
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
janitor::clean_names() %>%
mutate(cobertura = round(cobertura, 2)) %>%
filter(!is.na(.[[1]]),
!grepl("Gerado", .[[1]]))
return(dados)
}
read_xl_sipni("SIPNI_cobertura_UF_1994.xlsx")
# Leia, pivot_longer e combine os arquivos CSV em um único DataFrame
dados_combinados <- lapply(arquivos_xlsx, read_xl_sipni) %>%
bind_rows()
dados_combinados
dados_combinados %>%
rename(uf = unidade_da_federacao) %>%
mutate(ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo)))
dados_combinados %>%
rename(uf = unidade_da_federacao) %>%
mutate(ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo))) %>%
relocate(ano, .before = arquivo)
dados_combinados = dados_combinados %>%
rename(uf = unidade_da_federacao) %>%
mutate(ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo))) %>%
relocate(ano, .before = arquivo)
sipni_cobertura_uf_1994_2023 = dados_combinados %>%
rename(uf = unidade_da_federacao) %>%
mutate(ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo))) %>%
relocate(ano, .before = arquivo)
sipni_cobertura_uf_1994_2023 = sipni_cobertura_uf_1994_2023 %>%
rename(uf = unidade_da_federacao) %>%
mutate(ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo))) %>%
relocate(ano, .before = arquivo)
sipni_cobertura_uf_1994_2023
sipni_cobertura_uf_1994_2023 = dados_combinados %>%
rename(uf = unidade_da_federacao) %>%
mutate(ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo))) %>%
relocate(ano, .before = arquivo)
sipni_cobertura_uf_1994_2023
dados_combinados
sipni_cobertura_uf_1994_2023 = dados_combinados
sipni_cobertura_uf_1994_2023
sipni_cobertura_uf_1994_2023 %>%
group_by(uf, ano, imuno)
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
clean_names() %>%
rename(uf = unidade_da_federacao) %>%
mutate(cobertura = round(cobertura, 2),
ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo)),
uf = gsub("\\d", "", uf))  # Remove os números da coluna "uf" %>%
filter(!is.na(.[[1]]),
!grepl("Gerado", .[[1]]))
return(dados)
}
read_xl_sipni("SIPNI_cobertura_UF_1994.xlsx")
read_xl_sipni(here("SIPNI_cobertura_UF_1994.xlsx"))
read_xl_sipni("SIPNI_cobertura_UF_1994.xlsx")
read_xl_sipni("SIPNI_cobertura_UF_1994.xlsx")
here()
read_xl_sipni(here("SIPNI_cobertura_UF_1994.xlsx"))
arquivos_xlsx
read_xl_sipni(here("SIPNI_cobertura_UF_1994.xlsx"))
read_xl_sipni("SIPNI_cobertura_UF_1994.xlsx")
# Leia, pivot_longer e combine os arquivos CSV em um único DataFrame
sipni_cobertura_uf_1994_2023 <- lapply(arquivos_xlsx, read_xl_sipni) %>%
bind_rows()
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
clean_names() %>%
rename(uf = unidade_da_federacao) %>%
mutate(cobertura = round(cobertura, 2),
ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo)),
uf = gsub("\\d", "", uf))  # Remove os números da coluna "uf" %>%
filter(!is.na(uf),
!grepl("Gerado",uf))
return(dados)
}
# Leia, pivot_longer e combine os arquivos CSV em um único DataFrame
sipni_cobertura_uf_1994_2023 <- lapply(arquivos_xlsx, read_xl_sipni) %>%
bind_rows()
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
janitor::clean_names() %>%
mutate(cobertura = round(cobertura, 2),
ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo)),
uf = gsub("\\d", "", .[[2]]))  # Remove os números da coluna "uf" usando .[[2]]
dados <- dados %>%
filter(!is.na(uf),
!grepl("Gerado", uf))
return(dados)
}
# Leia, pivot_longer e combine os arquivos CSV em um único DataFrame
sipni_cobertura_uf_1994_2023 <- lapply(arquivos_xlsx, read_xl_sipni) %>%
bind_rows()
sipni_cobertura_uf_1994_2023
sipni_cobertura_uf_1994_2023 %>%
relocate(ano, .before = arquivo)
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
janitor::clean_names() %>%
rename(uf = unidade_da_federacao) %>%
mutate(cobertura = round(cobertura, 2),
ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo)),
uf = gsub("\\d", "", .[[2]]))  # Remove os números da coluna "uf" usando .[[2]]
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
janitor::clean_names() %>%
mutate(cobertura = round(cobertura, 2),
ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo)),
uf = gsub("\\d", "", .[[2]]))  # Remove os números da coluna "uf" usando .[[2]]
dados <- dados %>%
filter(!is.na(uf),
!grepl("Gerado", uf))
return(dados)
}
sipni_cobertura_uf_1994_2023 %>%
relocate(ano, .before = arquivo,
uf, .before = unidade_da_federacao) %>%
select(-unidade_da_federacao)
sipni_cobertura_uf_1994_2023 %>%
relocate(ano, .before = arquivo) %>%
relocate(uf, .before = unidade_da_federacao) %>%
select(-unidade_da_federacao)
sipni_cobertura_uf_1994_2023 %>%
relocate(ano, .before = arquivo)
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
janitor::clean_names() %>%
mutate(cobertura = round(cobertura, 2),
ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo)),
uf = gsub("\\d", "", .[[1]]))  %>%
select(-unidade_da_federacao) %>%
filter(!is.na(uf),
!grepl("Gerado", uf))
return(dados)
}
# Leia, pivot_longer e combine os arquivos CSV em um único DataFrame
sipni_cobertura_uf_1994_2023 <- lapply(arquivos_xlsx, read_xl_sipni) %>%
bind_rows()
sipni_cobertura_uf_1994_2023
#Criar funcao
read_xl_sipni <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
janitor::clean_names() %>%
mutate(cobertura = round(cobertura, 2),
ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo)),
uf = gsub("\\d", "", .[[1]]))  %>%
select(-unidade_da_federacao) %>%
filter(!is.na(uf),
!grepl("Gerado", uf)) %>%
select(uf, ano, imuno, cobertura)
return(dados)
}
# Leia, pivot_longer e combine os arquivos CSV em um único DataFrame
sipni_cobertura_uf_1994_2023 <- lapply(arquivos_xlsx, read_xl_sipni) %>%
bind_rows()
# Leia, pivot_longer e combine os arquivos CSV em um único DataFrame
sipni_cobertura_uf_1994_2023 <- lapply(arquivos_xlsx, read_xl_sipni) %>%
bind_rows()
sipni_cobertura_uf_1994_2023
sipni_cobertura_uf_1994_2023 %>%
group_by(uf, ano, imuno)
write.csv(sipni_cobertura_uf_1994_2023, file = "sipni_cobertura_uf_1994_2023.csv")
lista_MU_cobertura = list.files()
arquivos_xlsx
lista_MU_cobertura
# Lista todos os arquivos CSV no diretório
arquivos_xlsx <- list.files(here(), pattern = "\\.xlsx$", full.names = F)
arquivos_xlsx
#Criar funcao
read_xl_sipni_municipio <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
janitor::clean_names() %>%
mutate(cobertura = round(cobertura, 2),
ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo))) %>%
filter(!is.na(muni),
!grepl("Gerado", uf)) %>%
select(municipio, ano, imuno, cobertura) %>%
group_by(municipio, ano, imuno)
return(dados)
}
# Leia, pivot_longer e combine os arquivos CSV em um único DataFrame
sipni_cobertura_municipios_1994_2023 <- lapply(arquivos_xlsx, read_xl_sipni_municipio) %>%
bind_rows()
#Criar funcao
read_xl_sipni_municipio <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
janitor::clean_names() %>%
mutate(cobertura = round(cobertura, 2),
ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo))) %>%
filter(!is.na(muni),
!grepl("Gerado", uf)) %>%
select(municipio, ano, imuno, cobertura) %>%
group_by(municipio, ano, imuno)
return(dados)
}
#Criar funcao
read_xl_sipni_municipio <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
janitor::clean_names() %>%
mutate(cobertura = round(cobertura, 2),
ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo))) %>%
filter(!is.na(municipio),
!grepl("Gerado", municipio)) %>%
select(municipio, ano, imuno, cobertura) %>%
group_by(municipio, ano, imuno)
return(dados)
}
# Leia, pivot_longer e combine os arquivos CSV em um único DataFrame
sipni_cobertura_municipios_1994_2023 <- lapply(arquivos_xlsx, read_xl_sipni_municipio) %>%
bind_rows()
View(sipni_cobertura_municipios_1994_2023)
View(sipni_cobertura_municipios_1994_2023)
#Criar funcao
read_xl_sipni_municipio <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
janitor::clean_names() %>%
mutate(cobertura = round(cobertura, 2),
ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo))) %>%
filter(!is.na(municipio),
!grepl("Gerado", municipio)) %>%
select(municipio, ano, imuno, cobertura) %>%
group_by(municipio, ano, imuno)
return(dados)
}
# Leia, pivot_longer e combine os arquivos CSV em um único DataFrame
sipni_cobertura_municipios_1994_2023 <- lapply(arquivos_xlsx, read_xl_sipni_municipio) %>%
bind_rows()
lista_MU_cobertura = list.files()
arquivos_xlsx <- list.files(here(), pattern = "\\.xlsx$", full.names = F)
gc()
# Leia, pivot_longer e combine os arquivos CSV em um único DataFrame
sipni_cobertura_municipios_1994_2023 <- lapply(arquivos_xlsx, read_xl_sipni_municipio) %>%
bind_rows()
sipni_cobertura_municipios_1994_2023
View(sipni_cobertura_municipios_1994_2023)
#Criar funcao
read_xl_sipni_municipio <- function(arquivo) {
dados <- read_excel(arquivo, skip = 4, col_names = FALSE) %>%
setNames(.[1, ]) %>%
slice(-1:-4) %>%
mutate(across(-1, as.numeric)) %>%
pivot_longer(cols = -c(1),
names_to = "imuno",
values_to = "cobertura") %>%
mutate(arquivo = basename(arquivo)) %>%
janitor::clean_names() %>%
mutate(cobertura = round(cobertura, 2),
ano = as.numeric(gsub(".*_(\\d{4})\\.xlsx", "\\1", arquivo))) %>%
filter(!is.na(municipio),
!grepl("Gerado", municipio)) %>%
mutate(municipio = str_extract(municipio, "[[:alpha:][:space:]]+"),  # Extrai caracteres e espaços
codigo = as.numeric(str_extract(municipio, "\\d+")))  # Extrai números
dados <- dados %>%
select(municipio, codigo, ano, imuno, cobertura) %>%
group_by(municipio, codigo, ano, imuno)
return(dados)
}
# Exemplo de uso
arquivo_exemplo <- "SIPNI_cobertura_municipio_1994.xlsx"
dados_exemplo <- read_xl_sipni_municipio(arquivo_exemplo)
# Exemplo de uso
arquivo_exemplo <- "SIPNI_cobertura_municipio_1994.xlsx"
dados_exemplo <- read_xl_sipni_municipio(arquivo_exemplo)
# Exemplo de uso
arquivo_exemplo <- "SIPNI_cobertura_municipios_1994.xlsx"
dados_exemplo <- read_xl_sipni_municipio(arquivo_exemplo)
dados_exemplo
write.csv(sipni_cobertura_municipios_1994_2023, file = "sipni_cobertura_municipios_1994_2023.csv")
gse201533_counts_ready <- readRDS("C:/Users/Wasim/Downloads/gse201533_counts_ready.rds")
gse201533_metadata_ready <- readRDS("C:/Users/Wasim/Downloads/gse201533_metadata_ready.rds")
View(gse201533_counts_ready)
View(gse201533_metadata_ready)
View(gse201533_counts_ready)
library(DESeq2)
library(tidyverse)
gse201533_counts_ready
gse201533_counts_ready
gse201533_metadata_ready
colData <- gse201533_metadata_ready %>%
mutate(
Timepoint = factor(Timepoint),
Dose = factor(Dose),
Vaccine = factor(Vaccine),
FirstSecondDosef = factor(first.second.vaccine),
Group_I_II = factor(paste0(Vaccine, Dose, Timepoint, sep = "_")))
colData <- gse201533_metadata_ready %>%
mutate(
Timepoint = factor(Timepoint),
Dose = factor(Dose),
Vaccine = factor(Vaccine),
Group_I_II = factor(paste0(Vaccine, Dose, Timepoint, sep = "_")))
dds_grouped <- DESeqDataSetFromMatrix(countData = countData,
colData = colData,
design = ~ Group_I_II)
countData <- gse201533_counts_ready
colData <- gse201533_metadata_ready %>%
mutate(
Timepoint = factor(Timepoint),
Dose = factor(Dose),
Vaccine = factor(Vaccine),
Group_I_II = factor(paste0(Vaccine, Dose, Timepoint, sep = "_")))
dds_grouped <- DESeqDataSetFromMatrix(countData = countData,
colData = colData,
design = ~ Group_I_II)
keep <- rowSums(counts(dds)) >= 10
keep <- rowSums(counts(dds_grouped)) >= 10
dds_grouped <- dds_grouped[keep,]
dds_grouped = DESeq(dds_grouped)
dds_grouped = DESeq(dds_grouped)
gse201533_co
library(limma)
vsd <- vst(dds_grouped, blind=FALSE)
mat <- assay(vsd)
mat <- limma::removeBatchEffect(mat, vsd$Batch)
assay(vsd) <- mat
counts_batch_corrected <- assay(vsd)
plotPCA(dds, intgroup = c("Timepoint", "Vaccine", "Dose"))
plotPCA(dds_grouped, intgroup = c("Timepoint", "Vaccine", "Dose"))
counts_batch_corrected
mat
vsd
mat <- assay(vsd)
mat
counts_batch_corrected
vsd
